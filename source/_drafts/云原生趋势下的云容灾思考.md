title: 云原生趋势下的云容灾思考
author: 孙琦(Ray)
date: 2020-08-16 20:05:33
tags:
---
# 前言

云原生（Cloud Native）是最近几年非常火爆的话题，在2020年7月由信通院发布的《云原生发展白皮书（2020）年》明确指出：云计算的拐点已到，云原生成为驱动业务增长的重要引擎。随着以Kubernetes为基础的云原生环境广泛应用，我们不难发现云原生带给IT产业一次重新洗牌，从应用开发过程到IT从业者的技术能力，都是一次颠覆性的革命。

另外，我们也注意到在此基础上，出现了基于云原生平台的Open Application Model定义，在云原生平台基础上进一步抽象，更加关注应用而非基础架构。同时，在公有云上被广泛使用的Serverless服务，更加说明了未来的发展趋势：所有资源围绕着业务、应用为核心，轻量化基础架构层在应用发布中的角色。

某种意义上说，云原生的方向是新的一轮厂商锁定，就像当年盛极一时的IOE架构一样，只不过现在换成了云厂商作为底座承载应用。但是无论如何变化，IT整体发展方向，一定是向着更有利于业务快速迭代、满足业务需求演进的。在这种新的趋势下，很多传统基础架构层的技术被逐渐淡化甚至消亡，容灾技术便是其中之一。请注意一点，这里讲的并不是在云原生模式下不需要容灾了，而是原有容灾的某些技术的消亡。因为无论在任何发展阶段，容灾和备份是建设高可靠系统的必要组成部分。今天就从这个角度来分析一下，传统容灾为什么在云原生模式下不再适用了，以及在云原生的趋势下如何构建应用系统容灾。

<!-- more -->

# 传统容灾在云原生下的危机

## 危机产生的原因

为什么说传统的容灾方式在云环境下不再适用了呢？简单来说，二者关注的核心不同。传统的容灾往往以存储为核心，而基于云原生构建的应用核心变成了云原生服务本身。

我们以一个简单的Wordpress + MySQL环境为例，传统下的部署环境一般是这样架构的：

![upload successful](/images/pasted-58.png)

如果为这套应用架构设计一套容灾方案，可以采用以下的方式：

* 负载均衡节点容灾：负载均衡分为硬件和软件层面，硬件负载均衡高可靠和容灾往往通过自身的解决方案实现。如果是软件负载均衡，往往需要安装在基础操作系统上，而同城的容灾可以使用软件高可靠的方式实现，而异地的容灾往往是通过提前建立对等节点，或者干脆采用容灾软件的块或者文件级别容灾实现。是容灾切换（Failover）很重要的一个环节。
* Web Server的容灾：Wordpress的运行环境无非是Apache + PHP，由于分离了用于存放用户上传的文件系统，所以该节点几乎是无状态的，通过扩展节点即可实现高可靠，而异地容灾也比较简单，传统的块级别和文件级别都可以满足容灾的需求
* 共享文件系统的容灾，图中采用了Gluster的文件系统，由于分布式系统的一致性通常由内部维护，单纯使用块级别很难保证节点的一致性，所以这里面使用文件级别容灾更为精确
* 数据库的容灾，数据库的容灾可以简单的使用周期Dump数据库的方式实现，当然如果对可靠性要求较高，可以使用CDP方式来保证一个非常低的RPO时间

从以上的案例分析不难看出，传统基础架构下的容灾往往以存储为核心，无论是磁盘阵列的存储镜像，还是基于I/O数据块、字节级的捕获技术，结合网络、数据库和集群的应用级别技术完成高可靠和容灾体系的构建。在整个容灾过程的参与者主要为：主机、存储、网络和软件，相对来说比较单一。所以在传统容灾方案中，如何正确解决存储的容灾也就成为了解决问题的关键。

相同的一套方案，如果我们放到云上，架构是这样的：

![upload successful](/images/pasted-59.png)

由于云上可用区的其实就是同城容灾的概念，底层基础架构已经解决了同城容灾的需求，用户只需要根据最佳实践进行构建，就可以轻松实现一套高可靠的系统架构，但是我们从几年的行业新闻也不难发现，云总是有故障的，所以从业务连续性考虑建立异地容灾系统是非常有必要的。

我们来分析一下云上的架构：用户通过域名访问系统，域名可以使用云原生的DNS服务。负载均衡节点变成了云原生服务，共享文件系统变成了对象存储，物理主机变成了云主机，而数据库变成了云上的关系型数据库服务（RDS）。同时，利用弹性扩展服务（Auto Scaling）还可以实现轻松应对大规模并发引起的自动扩容。

*  动态DNS服务：

成本
编排



# 云原生趋势下的灾备新形态

# 云原生趋势下的灾备产品形态分析